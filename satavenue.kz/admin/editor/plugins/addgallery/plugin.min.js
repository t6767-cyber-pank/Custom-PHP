(function () {
	tinymce.PluginManager.requireLangPack('addgallery'); // подключили нашу локализацию

	tinymce.create('tinymce.plugins.addgallery', {
		init: function (ed, url) {
			var t = this;
			t.editor = ed;

			ed.addButton('addgallery', {
				title: 'Добавить галерею', // локализованный заголовок кнопки
				cmd: 'mceSniptBlock',  // команда, которая будет выполняться по щелчку на кнопку
				image: url + '/img/addgallery.gif' // иконка кнопки
			});

			ed.addCommand('mceSniptBlock', function () {
				moxman.browse({
					sort_by: "size",
					//select_multiple:1,
					oninsert: function (args) {
						var htmls="";
						for(var i=0;i<args.files.length;i++) {
							var html = '<div class="image">' + '<img src="' + args.files[i].path + '" /></div>';
							htmls= htmls+html;
						}
						ed.execCommand("mceInsertContent", false, htmls);
					}
				});
				return true;
			});
		}
	});
	tinymce.PluginManager.add('addgallery', tinymce.plugins.addgallery);
})();